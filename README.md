# TLS Topology RGR (Node.js + TypeScript)

–Ü–º—ñ—Ç–∞—Ü—ñ—è TLS/SSL ¬´—Ä—É–∫–æ—Å—Ç–∏—Å–∫–∞–Ω–Ω—è¬ª –∑:

- –æ–∫—Ä–µ–º–∏–º **CA-—Å–µ—Ä–≤–µ—Ä–æ–º** (—Ü–µ–Ω—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó),
- **—Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ—é —Ç–æ–ø–æ–ª–æ–≥—ñ—î—é** –∑ –∫—ñ–ª—å–∫–æ—Ö –Ω–æ–¥ (–≥—Ä–∞—Ñ),
- –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—î—é **—á–µ—Ä–µ–∑ –ø—Ä–æ–º—ñ–∂–Ω—ñ –≤—É–∑–ª–∏**,
- –æ–±–º–µ–∂–µ–Ω–Ω—è–º —Ä–æ–∑–º—ñ—Ä—É –ø–∞–∫–µ—Ç—É (—ñ–º—ñ—Ç–∞—Ü—ñ—è –ø–æ–≤—ñ–ª—å–Ω–æ–≥–æ —Ä–∞–¥—ñ–æ–∫–∞–Ω–∞–ª—É),
- –ø–µ—Ä–µ–¥–∞—á–µ—é –¥–∞–Ω–∏—Ö –ø–æ –∑–∞—Ö–∏—â–µ–Ω–æ–º—É –∫–∞–Ω–∞–ª—É (echo / —á–∞—Ç / —Ñ–∞–π–ª).

–ü—Ä–æ—î–∫—Ç –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–π –ø—ñ–¥ –†–ì–†: –±–∞–∑–æ–≤–∏–π + —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç (–∑ —Ç–æ–ø–æ–ª–æ–≥—ñ—î—é, CA-—Å–µ—Ä–≤–µ—Ä–æ–º, –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ –ø–∞–∫–µ—Ç–∞).

---

## üìä –î—ñ–∞–≥—Ä–∞–º–∏ —Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏, —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤ –¥–∏–≤—ñ—Ç—å—Å—è:

- **[ARCHITECTURE.md](./ARCHITECTURE.md)** - –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, –±–µ–∑–ø–µ–∫–∞
- **[INFRASTRUCTURE.md](./INFRASTRUCTURE.md)** - –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Ç–æ–ø–æ–ª–æ–≥—ñ—è –º–µ—Ä–µ–∂—ñ, —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
- **[PROTOCOL_FLOW.md](./PROTOCOL_FLOW.md)** - –ü—Ä–æ—Ç–æ–∫–æ–ª–∏, –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, state machines
- **[DIAGRAMS_INDEX.md](./DIAGRAMS_INDEX.md)** - –Ü–Ω–¥–µ–∫—Å –≤—Å—ñ—Ö –¥—ñ–∞–≥—Ä–∞–º —Ç–∞ —à–≤–∏–¥–∫–∏–π –¥–æ–≤—ñ–¥–Ω–∏–∫

–í—Å—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å Mermaid —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–Ω–¥–µ—Ä—è—Ç—å—Å—è –Ω–∞ GitHub/GitLab.

---

## 1. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

### 1.1. –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

- **CA Server (`ca-server.ts`)**

  - –ó–±–µ—Ä—ñ–≥–∞—î **root CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç**.
  - –ü—Ä–∏–π–º–∞—î –∑–∞–ø–∏—Ç–∏ `verify_cert`.
  - –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –Ω–æ–¥–∏:
    - –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π root CA,
    - –≤–∞–ª—ñ–¥–Ω–∏–π –ø–æ —á–∞—Å—É,
    - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ö–æ—Å—Ç–Ω–µ–π–º—É (CN).
  - –ü–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å `verify_result { valid: boolean }`.

- **Node Server (`node-server.ts`)**

  - –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–∏–º –ø—Ä–æ—Ü–µ—Å–æ–º –¥–ª—è –∫–æ–∂–Ω–æ—ó –Ω–æ–¥–∏ (`A`, `B`, `C`, ...).
  - –ú–∞—î –≤–ª–∞—Å–Ω—É –ø–∞—Ä—É –∫–ª—é—á/—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç (`A.key` / `A.crt`).
  - –í–∏—Å—Ç—É–ø–∞—î:
    - —è–∫ –∫—ñ–Ω—Ü–µ–≤–∏–π TLS-—Å–µ—Ä–≤–µ—Ä (—è–∫—â–æ –≤—ñ–Ω –æ—Å—Ç–∞–Ω–Ω—ñ–π —É `route`);
    - —è–∫ **–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä**, —è–∫—â–æ –≤—ñ–Ω –ø—Ä–æ–º—ñ–∂–Ω–∏–π –≤—É–∑–æ–ª —É –º–∞—Ä—à—Ä—É—Ç—ñ.

- **Client (`client.ts`)**
  - –Ü–Ω—ñ—Ü—ñ—é—î ¬´—Ä—É–∫–æ—Å—Ç–∏—Å–∫–∞–Ω–Ω—è¬ª –∑ —Ü—ñ–ª—å–æ–≤–æ—é –Ω–æ–¥–æ—é.
  - –ó–∞–ø–∏—Ç—É—î CA-—Å–µ—Ä–≤–µ—Ä –Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞.
  - –í–∏–∫–æ–Ω—É—î handshake (premaster, session key).
  - –î–∞–ª—ñ —à–ª–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ `data`-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (echo / —á–∞—Ç / —Ñ–∞–π–ª).

- **Broadcast Client (`broadcast-client.ts`)**
  - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ –≤—Å—ñ—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –Ω–æ–¥ —É —Ç–æ–ø–æ–ª–æ–≥—ñ—ó.
  - –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ –¥–æ—Å—è–∂–Ω—ñ –Ω–æ–¥–∏ —á–µ—Ä–µ–∑ –≥—Ä–∞—Ñ (BFS).
  - –î–ª—è –∫–æ–∂–Ω–æ—ó –Ω–æ–¥–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –æ–∫—Ä–µ–º–µ TLS-–∑'—î–¥–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –º–∞—Ä—à—Ä—É—Ç.
  - –ó–±–∏—Ä–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ —É—Å—ñ—Ö –Ω–æ–¥ —ñ –≤–∏–≤–æ–¥–∏—Ç—å –ø—ñ–¥—Å—É–º–æ–∫.

---

### 1.2. –õ–æ–≥—ñ—á–Ω–∞ —Å—Ö–µ–º–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó

```mermaid
graph LR
  subgraph CAServer[CA Service]
    CA[CA Server]
  end

  subgraph Network[–ì—Ä–∞—Ñ –Ω–æ–¥]
    A[Node A]
    B[Node B]
    C[Node C]
    D[Node D]
    E[Node E]
  end

  Client[Client] --> A
  A --- B
  B --- C
  C --- D
  C --- E

  Client -. –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ .-> CA
```

---

## 2. TLS-handshake —ñ –¥–∞–Ω—ñ: –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –ø–æ–¥—ñ–π

### 2.1. Handshake + CA –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è

```mermaid
sequenceDiagram
    participant Client
    participant A as Node A (first hop)
    participant B as Node B (router)
    participant E as Node E (target server)
    participant CA as CA Server

    Client->>A: ProtocolMessage( initial_handshake, route=[A,B,E] )
    A->>B: forward( initial_handshake )
    B->>E: forward( initial_handshake )

    E->>Client: initial_handshake + serverRandom + sslCertificate (—á–µ—Ä–µ–∑ B, A)

    Client->>CA: verify_cert(certificatePem, host="E")
    CA-->>Client: verify_result(valid=true)

    Client->>E: premaster (RSA encrypted) (—á–µ—Ä–µ–∑ A,B)
    E->>Client: ready (AES-GCM, session key) (—á–µ—Ä–µ–∑ B,A)
    Client->>E: ready (AES-GCM) (—á–µ—Ä–µ–∑ A,B)

    Note over Client,E: –û–±–∏–¥–≤—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –º–∞—é—Ç—å sessionKey, handshake –∑–∞–≤–µ—Ä—à–µ–Ω–æ
```

### 2.2. –û–±–º—ñ–Ω –¥–∞–Ω–∏–º–∏

```mermaid
sequenceDiagram
    participant Client
    participant A as Node A
    participant B as Node B
    participant E as Node E

    Client->>A: data (AES-GCM, action="echo", message="Hello")
    A->>B: forward data
    B->>E: forward data

    E->>E: decrypt & handle (echo)
    E->>B: response (AES-GCM)
    B->>A: forward response
    A->>Client: forward response

    Client->>Client: decrypt & print: echoedMessage
```

---

## 3. –¢–æ–ø–æ–ª–æ–≥—ñ—è —Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∏

–¢–æ–ø–æ–ª–æ–≥—ñ—è –æ–ø–∏—Å—É—î—Ç—å—Å—è —Ä—è–¥–∫–æ–º `routeMap`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

```text
"A:B,B:C,C:D,C:E"
```

–¶–µ –æ–∑–Ω–∞—á–∞—î:

```mermaid
graph LR
  A --- B
  B --- C
  C --- D
  C --- E
```

–ú–∞—Ä—à—Ä—É—Ç –º—ñ–∂ –Ω–æ–¥–∞–º–∏ —à—É–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `Graph.findRoute(from, to)` (BFS).
–ö–ª—ñ—î–Ω—Ç:

1. –°—Ç–≤–æ—Ä—é—î –≥—Ä–∞—Ñ —á–µ—Ä–µ–∑ `createMap(routeMap)`.
2. –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç `route = graph.findRoute(from, to)`.
3. –í–∫–ª–∞–¥–∞—î `route` –≤ –∫–æ–∂–µ–Ω `ProtocolMessage`.

–ü—Ä–æ–º—ñ–∂–Ω—ñ –Ω–æ–¥–∏:

- –¥–∏–≤–ª—è—Ç—å—Å—è –Ω–∞ `msg.route`,
- —à—É–∫–∞—é—Ç—å —Å–≤–æ—é –ø–æ–∑–∏—Ü—ñ—é –≤ –º–∞—Å–∏–≤—ñ,
- –ø–µ—Ä–µ—Å–∏–ª–∞—é—Ç—å –¥–∞–Ω—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –Ω–æ–¥—ñ.

---

## 4. –û–±–º–µ–∂–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É –ø–∞–∫–µ—Ç—É (–ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä–∞–¥—ñ–æ–∫–∞–Ω–∞–ª)

–£ `helpers.ts`:

```ts
export const MAX_PACKET_SIZE = 64;

export const sendWithPacketLimit = (socket: net.Socket, buffer: Buffer) => {
  for (let offset = 0; offset < buffer.length; offset += MAX_PACKET_SIZE) {
    const chunk = buffer.subarray(offset, offset + MAX_PACKET_SIZE);
    socket.write(chunk);
  }
};
```

–£—Å—ñ –º—ñ—Å—Ü—è, –¥–µ —â–æ—Å—å –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –≤ —Å–æ–∫–µ—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Å–∞–º–µ `sendWithPacketLimit` –∑–∞–º—ñ—Å—Ç—å –ø—Ä—è–º–æ–≥–æ `socket.write(buffer)`.

–¶–µ:

- —Ä—ñ–∂–µ –±—É–¥—å-—è–∫–∏–π –ª–æ–≥—ñ—á–Ω–æ —Ü—ñ–ª—ñ—Å–Ω–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª-–ø–∞–∫–µ—Ç –Ω–∞ —à–º–∞—Ç–∫–∏ –ø–æ 64 –±–∞–π—Ç–∏,
- —ñ–º—ñ—Ç—É—î –ø–æ–≤—ñ–ª—å–Ω–∏–π/–Ω–µ–Ω–∞–¥—ñ–π–Ω–∏–π —Ä–∞–¥—ñ–æ–∫–∞–Ω–∞–ª,
- –∑–º—É—à—É—î `DataHandler` –∞–¥–µ–∫–≤–∞—Ç–Ω–æ –∑–±–∏—Ä–∞—Ç–∏ —à–º–∞—Ç–∫–∏ –ø–æ `Content-Length`.

---

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```text
.
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ generate-certs.ps1
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ helpers.ts
‚îÇ   ‚îú‚îÄ‚îÄ graph.ts
‚îÇ   ‚îú‚îÄ‚îÄ ca-server.ts
‚îÇ   ‚îú‚îÄ‚îÄ node-server.ts
‚îÇ   ‚îú‚îÄ‚îÄ client.ts
‚îÇ   ‚îú‚îÄ‚îÄ broadcast-client.ts
‚îÇ   ‚îî‚îÄ‚îÄ protocol
‚îÇ       ‚îú‚îÄ‚îÄ messages.ts
‚îÇ       ‚îú‚îÄ‚îÄ dataHandler.ts
‚îÇ       ‚îú‚îÄ‚îÄ handshakeClient.ts
‚îÇ       ‚îî‚îÄ‚îÄ handshakeServer.ts
‚îî‚îÄ‚îÄ secrets
    ‚îú‚îÄ‚îÄ rootCA.crt
    ‚îú‚îÄ‚îÄ rootCA.key
    ‚îú‚îÄ‚îÄ node_A
    ‚îÇ   ‚îú‚îÄ‚îÄ A.key
    ‚îÇ   ‚îî‚îÄ‚îÄ A.crt
    ‚îú‚îÄ‚îÄ node_B
    ‚îÇ   ‚îú‚îÄ‚îÄ B.key
    ‚îÇ   ‚îî‚îÄ‚îÄ B.crt
    ‚îî‚îÄ‚îÄ ...
```

---

## 6. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞

### 6.1. –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- **Node.js** (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ >= 18)
- **npm**
- **OpenSSL** —É PATH (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤)
- Windows (–æ—Å–Ω–æ–≤–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π) + PowerShell

### 6.2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
npm install
```

---

## 7. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–ª—é—á—ñ–≤ —ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤

–í –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É —î —Å–∫—Ä–∏–ø—Ç `generate-certs.ps1`, —è–∫–∏–π:

- —Å—Ç–≤–æ—Ä—é—î `secrets/` —ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ:

  - `rootCA.key`, `rootCA.crt`,
  - –¥–ª—è –∫–æ–∂–Ω–æ—ó –Ω–æ–¥–∏ (A‚ÄìE): –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `node_X` –∑ `X.key` —ñ `X.crt`.

–ó–∞–ø—É—Å–∫:

```powershell
# (–æ–ø—Ü—ñ–π–Ω–æ) –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∏ –≤ —Ü—å–æ–º—É —Å–µ–∞–Ω—Å—ñ
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass

# –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –¥–ª—è A,B,C,D,E
powershell -ExecutionPolicy Bypass -File .\generate-certs.ps1
```

–Ø–∫—â–æ —Ç—Ä–µ–±–∞ —ñ–Ω—à—ñ –Ω–æ–¥–∏:

```powershell
powershell -ExecutionPolicy Bypass -File .\generate-certs.ps1 -Nodes A,B,C,D,E,F
```

---

## 8. –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

### 8.1. –ó–∞–ø—É—Å–∫ CA-—Å–µ—Ä–≤–µ—Ä–∞

```bash
npx ts-node src/ca-server.ts --port 9000
```

–ê—Ä–≥—É–º–µ–Ω—Ç–∏:

- `--port` ‚Äì –ø–æ—Ä—Ç CA (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 9000).

### 8.2. –ó–∞–ø—É—Å–∫ –Ω–æ–¥

–ó–∞–ø—É—Å–∫–∞—î–º–æ –≤ **–æ–∫—Ä–µ–º–∏—Ö —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞—Ö**:

```bash
# Node A
npx ts-node src/node-server.ts --name A --port 7000

# Node B
npx ts-node src/node-server.ts --name B --port 7001

# Node C
npx ts-node src/node-server.ts --name C --port 7002

# Node D
npx ts-node src/node-server.ts --name D --port 7003

# Node E
npx ts-node src/node-server.ts --name E --port 7004
```

> –ü–æ—Ä—Ç–∏ –º–æ–∂–Ω–∞ –Ω–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ ‚Äî —î –ø—Ä–æ—Å—Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è `guessPortForNode`, —è–∫–∞ —Ä–∞—Ö—É—î –ø–æ—Ä—Ç –≤—ñ–¥ –ª—ñ—Ç–µ—Ä–∏ –Ω–æ–¥–∏. –ê–ª–µ –¥–ª—è —è–≤–Ω–æ—Å—Ç—ñ –∫—Ä–∞—â–µ –ø–µ—Ä–µ–¥–∞—Ç–∏ `--port`.

### 8.3. –ó–∞–ø—É—Å–∫ –∫–ª—ñ—î–Ω—Ç–∞ (echo)

```bash
npx ts-node src/client.ts ^
  --from A ^
  --to E ^
  --routeMap "A:B,B:C,C:D,C:E" ^
  --caHost localhost ^
  --caPort 9000 ^
  --message "Hello secure world"
```

- `--from` ‚Äì —Å—Ç–∞—Ä—Ç–æ–≤–∞ –Ω–æ–¥–∞ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç—É (–ª–æ–≥—ñ—á–Ω–∞, –∫–ª—ñ—î–Ω—Ç –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è —Å–∞–º–µ –¥–æ –Ω–µ—ó).
- `--to` ‚Äì —Ü—ñ–ª—å–æ–≤–∞ –Ω–æ–¥–∞ (–∫—ñ–Ω—Ü–µ–≤–∏–π TLS-—Å–µ—Ä–≤–µ—Ä).
- `--routeMap` ‚Äì —Ç–æ–ø–æ–ª–æ–≥—ñ—è –≥—Ä–∞—Ñ–∞.
- `--message` ‚Äì —Ç–µ–∫—Å—Ç–æ–≤–∏–π echo-–º–µ—Å–µ–¥–∂.

–ö–ª—ñ—î–Ω—Ç:

1. –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç `A -> B -> C -> E`.
2. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î TCP –¥–æ `A`.
3. –†–æ–±–∏—Ç—å handshake –¥–æ `E` —á–µ—Ä–µ–∑ `A` —ñ `C`.
4. –®–ª–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π `echo` —ñ –≤–∏–≤–æ–¥–∏—Ç—å —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å.

### 8.4. –ó–∞–ø—É—Å–∫ –∫–ª—ñ—î–Ω—Ç–∞ (—Ñ–∞–π–ª)

```bash
npx ts-node src/client.ts ^
  --from A ^
  --to E ^
  --routeMap "A:B,B:C,C:D,C:E" ^
  --caHost localhost ^
  --caPort 9000 ^
  --file .\example.txt
```

- –ö–ª—ñ—î–Ω—Ç –ø—Ä–æ—á–∏—Ç–∞—î `example.txt`,
- –∑–∞–ø–∞–∫—É—î –≤ `action="chat", message="[FILE example.txt]\n<–≤–º—ñ—Å—Ç>"`,
- –∑–∞—à–∏—Ñ—Ä—É—î —ñ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å –¥–æ `E`.

### 8.5. –ó–∞–ø—É—Å–∫ Broadcast

Broadcast –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ –≤—Å—ñ—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –Ω–æ–¥ —É —Ç–æ–ø–æ–ª–æ–≥—ñ—ó –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –º–∞—Ä—à—Ä—É—Ç—ñ–≤.

**–í–∞–∂–ª–∏–≤–æ:** –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º broadcast –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏:
- CA-—Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 9000)
- –í—Å—ñ –Ω–æ–¥–∏, —è–∫—ñ —î –≤ `routeMap`

**–ó–∞–ø—É—Å–∫:**

```bash
npx ts-node src/broadcast-client.ts \
  --from A \
  --routeMap "A:B,B:C,C:D" \
  --message "Broadcast message" \
  --action echo
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**

- `--from` ‚Äì —Å—Ç–∞—Ä—Ç–æ–≤–∞ –Ω–æ–¥–∞ –¥–ª—è –ø–æ—à—É–∫—É –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –Ω–æ–¥ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `A`)
- `--routeMap` ‚Äì —Ç–æ–ø–æ–ª–æ–≥—ñ—è –≥—Ä–∞—Ñ–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `A:B,B:C,C:D,C:E`)
- `--message` ‚Äì –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `Broadcast message`)
- `--action` ‚Äì —Ç–∏–ø –¥—ñ—ó: `echo`, `chat`, –∞–±–æ `broadcast` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `echo`)
- `--caHost` ‚Äì —Ö–æ—Å—Ç CA-—Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `localhost`)
- `--caPort` ‚Äì –ø–æ—Ä—Ç CA-—Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `9000`)

**–Ø–∫ –ø—Ä–∞—Ü—é—î:**

1. Broadcast-–∫–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î –≥—Ä–∞—Ñ –∑ `routeMap`
2. –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ –¥–æ—Å—è–∂–Ω—ñ –Ω–æ–¥–∏ –≤—ñ–¥ —Å—Ç–∞—Ä—Ç–æ–≤–æ—ó –Ω–æ–¥–∏ —á–µ—Ä–µ–∑ BFS (`getAllReachableNodes`)
3. –î–ª—è –∫–æ–∂–Ω–æ—ó –Ω–æ–¥–∏:
   - –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ —Ç–æ–ø–æ–ª–æ–≥—ñ—é (`findRoute`)
   - –í—Å—Ç–∞–Ω–æ–≤–ª—é—î TLS-–∑'—î–¥–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –º–∞—Ä—à—Ä—É—Ç (handshake)
   - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
   - –û—Ç—Ä–∏–º—É—î —Ç–∞ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å
4. –í–∏–≤–æ–¥–∏—Ç—å –ø—ñ–¥—Å—É–º–æ–∫ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏ –≤—ñ–¥ —É—Å—ñ—Ö –Ω–æ–¥

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:**

```
[Broadcast] Starting from node A
[Broadcast] Route map: A:B,B:C,C:D
[Broadcast] Nodes in graph: A, B, C, D
[Broadcast] Reachable nodes: A, B, C, D
[Broadcast] Sending message: "Broadcast message"

[Broadcast] Sending to A via route: A
[Broadcast] Response from A: {
  "echoedMessage": "[A] Broadcast message"
}

[Broadcast] Sending to B via route: A -> B
[Broadcast] Response from B: {
  "echoedMessage": "[B] Broadcast message"
}

...

==================================================
Broadcast Summary:
==================================================
Total nodes: 4
Successful: 4
Failed: 0
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ß–µ—Ä–µ–∑ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –æ–±—Ä–æ–±–∫–∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –≤ PowerShell —Ç–∞ npm, —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä—è–º–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `npx ts-node` –∑–∞–º—ñ—Å—Ç—å `npm run start:broadcast`.

---

## 9. –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –≤–∏–º–æ–≥–∞–º –†–ì–†

| –ü—É–Ω–∫—Ç –†–ì–†                                          | –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —É –ø—Ä–æ—î–∫—Ç—ñ                                    |
| -------------------------------------------------- | ------------------------------------------------------- |
| –ö–ª—ñ—î–Ω—Ç —à–ª–µ random ¬´–ø—Ä–∏–≤—ñ—Ç¬ª                         | `ClientHandShakeHandler.initiateHandShake()` (`random`) |
| –°–µ—Ä–≤–µ—Ä —à–ª–µ random + —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç                     | `ServerHandShakeHandler.handleInitialHandShake()`       |
| –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ –≤ —Ü–µ–Ω—Ç—Ä—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó        | `verifyCertificateViaCa()` + `ca-server.ts`             |
| –ö–ª—ñ—î–Ω—Ç —à–ª–µ premaster, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π public key      | `Premaster.encrypt()` + message `type: 'premaster'`     |
| –°–µ—Ä–≤–µ—Ä —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î premaster                       | `Premaster.decrypt()` –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ                        |
| –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–ª—é—á—ñ–≤ —Å–µ–∞–Ω—Å—É –∑ random + premaster       | `genSessionKey()` (HKDF)                                |
| –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "ready", –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–µ —Å–µ–∞–Ω—Å–æ–≤–∏–º –∫–ª—é—á–µ–º | `READY_MESSAGE` + `Message.encrypt()`                   |
| –ü–æ–¥–∞–ª—å—à–µ —Å–∏–º–µ—Ç—Ä–∏—á–Ω–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è                     | `Message.encrypt/decrypt()` (AES-256-GCM)               |
| –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–∏—Ö (—á–∞—Ç / —Ñ–∞–π–ª)                        | `client.ts` (`echo` / `chat`)                           |
| –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∞ —Ç–æ–ø–æ–ª–æ–≥—ñ—è 5+ –Ω–æ–¥                       | `graph.ts` + `routeMap` + –¥–µ–∫—ñ–ª—å–∫–∞ `node-server`        |
| Handshake –º—ñ–∂ –±—É–¥—å-—è–∫–æ—é –ø–∞—Ä–æ—é —á–µ—Ä–µ–∑ –ø—Ä–æ–º—ñ–∂–Ω—ñ –Ω–æ–¥–∏  | `route` + —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ —É `node-server.ts`                 |
| –û–±–º–µ–∂–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É –ø–∞–∫–µ—Ç—É                           | `MAX_PACKET_SIZE` + `sendWithPacketLimit()`             |
| Broadcast –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ç–æ–ø–æ–ª–æ–≥—ñ—ó                  | `broadcast-client.ts` + `graph.getAllReachableNodes()`   |

> Broadcast —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —è–∫ –æ–∫—Ä–µ–º–∏–π –∫–ª—ñ—î–Ω—Ç, —è–∫–∏–π –æ–±—Ö–æ–¥–∏—Ç—å —É—Å—ñ –¥–æ—Å—è–∂–Ω—ñ –Ω–æ–¥–∏ –≤ –≥—Ä–∞—Ñ—ñ —á–µ—Ä–µ–∑ BFS —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —ó–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ –ø–æ–±—É–¥–æ–≤–∞–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö –∑ –ø–æ–≤–Ω–∏–º TLS handshake –¥–ª—è –∫–æ–∂–Ω–æ—ó –Ω–æ–¥–∏.

---

## 10. –Ü–¥–µ—ó –¥–ª—è —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è / –¥–æ–ø–∏–ª—é–≤–∞–Ω–Ω—è

- –õ–æ–≥–∏:

  - –ª–æ–≥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–æ–∫—É handshake (–∑ random, premaster, session key),
  - –ª–æ–≥—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É (–Ω–∞ –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –Ω–æ–¥–∞—Ö).

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:

  - –≤—Å—Ç–∞–≤–∏—Ç–∏ —Å–∫—Ä—ñ–Ω–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ–≤ —É –∑–≤—ñ—Ç (CA, –Ω–æ–¥–∏, –∫–ª—ñ—î–Ω—Ç),
  - –æ–∫—Ä–µ–º–æ –æ–ø–∏—Å–∞—Ç–∏ HKDF, AES-GCM, RSA-OAEP.

---

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂—É:

- –∞–¥–∞–ø—Ç—É–≤–∞—Ç–∏ README –ø—ñ–¥ —Ñ–æ—Ä–º–∞—Ç —Å–∞–º–µ —Ç–≤–æ–≥–æ –∑–≤—ñ—Ç—É (–∑ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞–º–∏ 1‚Äì5, —Ç–∞–±–ª–∏—Ü—è–º–∏ / –±–ª–æ–∫-—Å—Ö–µ–º–∞–º–∏),
- –∞–±–æ –¥–æ–¥–∞—Ç–∏ —â–µ 1‚Äì2 Mermaid-–¥—ñ–∞–≥—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ñ–∞–π–ª—ñ–≤ —á–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É handshake-–∫–ª–∞—Å—ñ–≤).
